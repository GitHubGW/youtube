extends ../layout
include ../mixins/mixinVideo
include ../mixins/mixinVideoPlayer
include ../mixins/mixinVideoDetail

block content 
  .video-detail__container
    .video-detail__main
      +mixinVideoPlayer(video)
      .video__info
        h5.video__title=video.title
        .video__viewDate
          if true
            span 조회수   
            span.video__views 1
          else 
            span 조회수   
            span.video__views
          em •
          span.video__date #{new Date(video.createdAt).toLocaleDateString("ko-KR")}
          if loggedInUser
            if String(user._id) === String(loggedInUser._id)
              a(href=`${video._id}/edit`) 
                button 비디오 수정
        .division-line
        .video__author
          .video__author__avatar
            a(href=`/users/${video.user.username}`)
              if video.user.avatarUrl
                img(src=video.user.avatarUrl crossorigin)
              else
                img(src="/images/profile_user.png" crossorigin)
          a(href=`/users/${video.user.username}`)=video.user.username
        .video__description 
          pre #{video.description}
        .division-line
      .video__comments 
        if true
          span.video__comment-number
            |댓글
            span#jsCommentNumber 1
            |개
        else if true
          span.video__comment-number 
            |댓글
            span#jsCommentNumber 0
            |개
        else
          span.video__comment-number
            |댓글
            span#jsCommentNumber
            |개
        form(class="add__comment" id="jsCommentForm")
          if loggedInUser===null
            img(src="/images/comment_user.png" crossorigin)
          else 
            if loggedInUser.avatarUrl
              img(src=loggedInUser.avatarUrl crossorigin)
            else 
              img(src="/images/comment_user.png" crossorigin)
          input(type="text" placeholder="공개 댓글 추가..." name="comment" id="jsCommentInput" min="1")
        
        ul(class="video__comments-list" id="jsCommentList")
          each comment in video.comments.reverse()
            li(class="comment__item" id=comment._id)
              .comment__image
                if !comment.user.avatarUrl
                  a(href=`/users/${comment.user.username}`) 
                    img(src="/images/comment_user.png" crossorigin)
                else 
                  if comment.user.avatarUrl
                    a(href=`/users/${comment.user.username}`)
                      img(src=comment.user.avatarUrl crossorigin)
                  else 
                    a(href=`/users/${comment.user.username}`)
                      img(src="/images/comment_user.png" crossorigin)
              .comment__content
                .comment__author 
                  span
                    a(href=`/users/${comment.user.username}`) #{comment.user.username}
                  span #{new Date(video.createdAt).toLocaleDateString("ko-KR")}
                  if loggedInUser && (`${comment.user._id}` === loggedInUser._id)
                    button.comment__delete
                      i.fas.fa-times-circle
                .comment__description #{comment.text}

    .video-detail__aside
      each video in videos
        +mixinVideoDetail(video)

block script
  script(src="/assets/js/videoPlayer.js") 
  script(src="/assets/js/thumbnailVideo.js")
  script(src="/assets/js/comment.js") 